## 测试

### (1) 创建新的用户

**创建用户命令如下：**

```
curl -XPOST -H"Content-Type: application/json" http://127.0.0.1:5555/v1/users -d'{"username":"authztest","password":"miniblog1234","nickname":"colin404","email":"colin404@foxmail.com","phone":"18130000000"}'
```

**返回结果：**
```
{"userID":"user-die7iy"}
```

**说明：** 上述命令会新建一个名为 authztest 的测试用户，接口返回用户的 ID: user-die7iy。

---

### (2) 使用普通用户访问 GET /v1/users 接口

**命令如下：**

```
user_token=`curl -s -XPOST -H"Content-Type: application/json" http://127.0.0.1:5555/login -d'{"username":"authztest","password":"miniblog1234"}'|jq -r .token`

curl -H"Authorization: Bearer ${user_token}" "http://127.0.0.1:5555/v1/users?limit=1"
```

**返回结果：**
```
{"code":7,"message":"access denied: subject=user-die7iy,object=/v1. MiniBlog/ListUser, action=CALL, reason=<nil>","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"PermissionDenied","metadata":{"X-Request-ID":"bcfd9076-549f-4139-8f8f-710218521190"}}]}
```

**说明：** 上述命令尝试以普通用户的身份访问 GET /v1/users 接口，因为权限不足，导致报 PermissionDenied 错误。

---

### (3) 使用管理员用户访问 GET /v1/users 接口

**命令如下：**

```
curl -s -XPOST -H"Content-Type: application/json" http://127.0.0.1:5555/login -d'{"username":"root","password":"miniblog1234"}'

curl -H"Authorization: Bearer ${admin_token}" "http://127.0.0.1:5555/v1/users?limit=1"
```

**返回结果：**
```
{"totalCount":"2","users":[{"userID":"user-die7iy","username":"authntest","nickname":"colin404","email":"colin404@foxmail.com","phone":"18130000000","createdAt":"2025-02-01T13:45:09Z","updatedAt":"2025-02-01T13:45:09.328211797Z"}]}
```

**说明：** 使用管理员用户可以成功访问 GET /v1/users 接口。

## 技术要点总结

这个示例清晰地展示了：
- **用户创建流程**：通过 API 创建新用户
- **权限验证机制**：普通用户 vs 管理员用户的权限差异
- **错误处理**：权限不足时的详细错误信息
- **API 设计**：RESTful 接口设计和认证机制（Bearer Token）

这是一个完整的权限管理系统演示，体现了基于角色的访问控制（RBAC）的实际应用。